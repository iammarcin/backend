[pytest]
pythonpath = .
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

filterwarnings =
    ignore:Using `@model_validator` with mode='after':UserWarning:google\.genai
    ignore:Core Pydantic V1 functionality isn't compatible with Python 3.14 or greater.:UserWarning:fastapi\._compat\.v1
    ignore:'_UnionGenericAlias' is deprecated and slated for removal in Python 3.17:DeprecationWarning:google\.genai\.types
    ignore:ConnectionClosed\.(code|reason) is deprecated:DeprecationWarning:websockets\.exceptions
    ignore:coroutine 'AsyncMockMixin\._execute_mock_call' was never awaited:RuntimeWarning:features\.chat\.utils\.chat_history_formatter
    ignore:coroutine 'InterceptedUnaryUnaryCall\._invoke' was never awaited:RuntimeWarning:_pytest\.stash
    ignore:Exception ignored in.*InterceptedCall\.__del__:pytest.PytestUnraisableExceptionWarning
    ignore:.*has no attribute '_interceptors_task':pytest.PytestUnraisableExceptionWarning
    ignore:Inheritance class AiohttpClientSession from ClientSession is discouraged:DeprecationWarning:google\.genai\._api_client
    ignore:asyncio_default_fixture_loop_scope is deprecated:DeprecationWarning:pytest
    ignore:Using `@model_validator` with mode='after'::google\.genai
    ignore:coroutine 'Connection._cancel' was never awaited:RuntimeWarning

markers =
    batch: mark slow batch tests that should be run separately
    asyncio: mark test as requiring an asyncio event loop
    anyio: mark test as requiring AnyIO-powered async support
    requires_docker: mark test as needing access to the local Docker daemon
    live_api: mark tests that hit real third-party provider APIs
    integration: mark integration tests that may interact with multiple services or subsystems
    requires_semantic_search: mark tests that require semantic search to be configured (OPENAI_API_KEY, QDRANT_URL)
    requires_garmin_db: mark tests that require Garmin database to be configured (GARMIN_DB_URL)
    requires_ufc_db: mark tests that require UFC database to be configured (UFC_DB_URL)
    requires_sqs: mark tests that require SQS queue service to be configured (AWS credentials)
    requires_openai: mark tests that require OpenAI API key
    requires_google: mark tests that require Google/Gemini API key
    requires_anthropic: mark tests that require Anthropic API key
    requires_openai_api_key: alias for OpenAI-required tests (batch integrations)
    requires_anthropic_api_key: alias for Anthropic-required tests (batch integrations)
    requires_gemini_api_key: alias for Gemini-required tests (batch integrations)
    batch_integration: mark tests that exercise real batch provider APIs
    requires_concurrent_loop: mark tests that exercise the concurrent message processing loop
    e2e_websocket: mark tests that use real WebSocket connections for end-to-end validation
    openai: mark tests related to OpenAI provider
    anthropic: mark tests related to Anthropic provider workflows
    agentic: mark tests for agentic workflows
    serialization: mark tests for JSON serialization validation
